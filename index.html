<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Timesheet V34 Extended Holidays</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- ExcelJS & FileSaver -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        input, select, textarea { font-size: 16px !important; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .suggestion-list {
            max-height: 250px;
            overflow-y: auto;
            position: absolute;
            z-index: 50;
            width: 100%;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .suggestion-item { padding: 0.5rem; font-size: 0.875rem; cursor: pointer; border-bottom: 1px solid #f1f5f9; }
        .suggestion-item:hover { background-color: #eff6ff; }
    </style>
</head>
<body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // --- ICONS ---
        const Icons = {
            Settings: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Download: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Plus: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Trash: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Edit: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            Cloud: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>,
            Refresh: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
            Upload: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
            Database: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>,
            Alert: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        };

        // --- DATA CONFIG ---
        const OT_TYPES = [
            { code: 'NORMAL', label: 'Giờ công thường' }, 
            { code: 'OT1', label: 'OT1 (17:00-22:00 T2-T7)' },
            { code: 'OT2', label: 'OT2 (08:00-22:00 CN/Chiều T7)' },
            { code: 'OT3', label: 'OT3 (08:00-22:00 Lễ)' },
            { code: 'OT4', label: 'OT4 (22:00-06:00 Đêm)' },
            { code: 'OT5', label: 'OT5 (22:00-06:00 Đêm T7/CN)' },
            { code: 'OT6', label: 'OT6 (22:00-06:00 Đêm Lễ)' },
            { code: 'OT7', label: 'OT7 (Đêm có OT trước)' },
        ];
        
        // COMMON VIETNAMESE HOLIDAYS
        const VN_HOLIDAYS = [
            '01-01', '04-30', '05-01', '09-02', '09-03', // Fixed
            // 2024
            '2024-02-08', '2024-02-09', '2024-02-10', '2024-02-11', '2024-02-12', '2024-02-13', '2024-02-14', // Tet 2024
            '2024-04-18', // Hung Kings 2024
            // 2025
            '2025-01-28', '2025-01-29', '2025-01-30', '2025-01-31', '2025-02-01', // Tet 2025
            '2025-04-07', // Hung Kings 2025
            // 2026 (NEW)
            '2026-02-16', '2026-02-17', '2026-02-18', '2026-02-19', '2026-02-20', // Tet 2026 (29 Dec -> 4 Jan)
            '2026-04-26', '2026-04-27', // Hung Kings 2026 (10/3 Lunar is Sun 26/4, observed Mon 27/4)
            // 2027 (NEW)
            '2027-02-05', '2027-02-06', '2027-02-07', '2027-02-08', '2027-02-09', // Tet 2027 (29 Dec -> 4 Jan)
            '2027-04-16', // Hung Kings 2027 (10/3 Lunar is Fri 16/4)
        ];

        const isVietnameseHoliday = (dateStr) => {
            if (!dateStr) return false;
            if (VN_HOLIDAYS.includes(dateStr)) return true;
            const [y, m, d] = dateStr.split('-');
            const md = `${m}-${d}`;
            if (['01-01', '04-30', '05-01', '09-02'].includes(md)) return true;
            return false;
        };

        const HR_WORK_NUMBERS = ['PAID LEAVE', 'UNPAID LEAVE', 'TRAINING-NI', 'TRAINING-EI', 'MEETINGS'];

        const ACTIVITY_META = [
            { id: '100', code: '100', cat: 'NI', desc: '100 - Travel (thời gian đi đường đến công trình tỉnh)' },
            { id: '1193', code: '1193', cat: 'NI', desc: '1193 - NI Quality hour ( pre-work)' },
            { id: '1110', code: '1110', cat: 'NI', desc: '1110 - NI Prod. Hours Fitter (thời gian lắp đặt)' },
            { id: '1731', code: '1731', cat: 'NI', desc: '1731 - T&C (Thời gian thử nghiệm và vận hành)' },
            { id: '1194', code: '1194', cat: 'NI', desc: '1194 - NI Quality Hour ( open item) (Thời gian sửa lỗi và các hạng mục dỡ dang)' },
            { id: '1720', code: '1720', cat: 'Other', desc: '1720 - MOD (Sửa chữa lớn)' },
            { id: '1900', code: '1900', cat: 'NI', desc: '1900 - Other NI' },
            { id: '1191', code: '1191', cat: 'NI', desc: '1191 - NI' },
            { id: '1192-1', code: '1192', cat: 'NI', desc: '1192 - NI Quality' }, 
            { id: '1192-2', code: '1192', cat: 'NI', desc: '1192 - NI Quality' }, 
            { id: '1393', code: '1393', cat: 'MOD', desc: '1393 - MOD Quality hour ( Pre-work)' },
            { id: '1394', code: '1394', cat: 'MOD', desc: '1394 - MOD Quality Hour ( open item)' },
            { id: '1310', code: '1310', cat: 'MOD', desc: '1310 - MOD Prod. Hours Fitter' },
            { id: '1392', code: '1392', cat: 'MOD', desc: '1392 - MOD Quality hours - Logistics' },
            { id: '1400', code: '1400', cat: 'EI', desc: '1400 - Maintenance (Bảo trì)' },
            { id: '1500', code: '1500', cat: 'EI', desc: '1500 - Call back' },
            { id: '1600', code: '1600', cat: 'EI', desc: '1600 - Repair' },
            { id: '1710', code: '1710', cat: 'TF', desc: '1710 - SAIS Acceptance Test' },
            { id: '1715', code: '1715', cat: 'TF', desc: '1715 - SAIS Re-Inspection' },
            { id: '1725', code: '1725', cat: 'TF', desc: '1725 - CPSI' },
            { id: '1700', code: '1700', cat: 'SAF', desc: '1700 - Safety' },
            { id: '5010', code: '5010', cat: 'HR', desc: '5010 - Meetings (Họp)' },
            { id: '5021', code: '5021', cat: 'HR', desc: '5021 - Training-Classroom (Huấn luyện - trong lớp)' },
            { id: '5022', code: '5022', cat: 'HR', desc: '5022 - Training-On the job (Huấn luyện tại công trường)' },
            { id: '5040', code: '5040', cat: 'HR', desc: '5040 - Other Administrative Task (nhiệm vụ khác không thuộc công trình)' },
            { id: '5090', code: '5090', cat: 'NI', desc: '5090/ ES1 (NI) Supervisor, Safety, Travelling time' },
            { id: '5060', code: '5060', cat: 'HR', desc: '5060 - Safety / Tools Box Meeting (Họp giao ban an toàn)' },
            { id: '6010', code: '6010', cat: 'HR', desc: '6010/1 - Holiday / Public Holiday / Annual Leave day/hr (Nghỉ hưởng lương)' },
            { id: '6020', code: '6020', cat: 'HR', desc: '6020 - Illness (day) / Medical / Accident (nghỉ ốm, nghỉ tai nạn)' },
            { id: '6090', code: '6090', cat: 'HR', desc: '6090 - Unpaid leave (Nghỉ không hưởng lương)' },
            { id: '1192-0', code: '1192-0', cat: 'NI', desc: 'NI Quality hours- logistics' }, 
            { id: '1192-1', code: '1192-1', cat: 'NI', desc: 'NI Quality hours-Material/ Fi/LPCA/Site Cause' } 
        ];

        const ACTIVITY_OPTIONS = ACTIVITY_META.map(a => ({ id: a.id, label: a.desc, cat: a.cat }));
        ACTIVITY_OPTIONS.push({ id: 'OTHER', label: 'Khác (Nhập tay code)', cat: 'OTHER' });

        const getSalaryPeriod = (monthStr) => {
            if(!monthStr) return { start: '', end: '', label: '' };
            const [year, month] = monthStr.split('-').map(Number);
            const startDate = new Date(year, month - 2, 16);
            const startDateStr = startDate.toISOString().slice(0, 10);
            const endDate = new Date(year, month - 1, 15);
            const endDateStr = endDate.toISOString().slice(0, 10);
            const formatDate = (d) => `${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}`;
            return { start: startDateStr, end: endDateStr, label: `${formatDate(startDate)} - ${formatDate(endDate)}` };
        };

        const timeToExcel = (timeStr) => {
            if (!timeStr) return 0;
            const [h, m] = timeStr.split(':').map(Number);
            return (h + m/60) / 24;
        };

        const calculateHours = (start, end, breakTime) => {
            if(!start || !end) return 0;
            const [h1, m1] = start.split(':').map(Number);
            const [h2, m2] = end.split(':').map(Number);
            let diff = (h2 + m2/60) - (h1 + m1/60);
            if(diff < 0) diff += 24; 
            return Math.max(0, diff - (parseFloat(breakTime) || 0));
        };

        const formatMonthVietnamese = (yyyy_mm) => {
            if(!yyyy_mm) return "";
            const [y, m] = yyyy_mm.split('-');
            return `Tháng ${parseInt(m)}`;
        };

        const normalizeString = (str) => str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/đ/g, 'd').replace(/Đ/g, 'D').toLowerCase();
        const removeAccents = (str) => normalizeString(str).replace(/\s+/g, '_');

        function App() {
            const [view, setView] = useState('list'); 
            const [entries, setEntries] = useState([]);
            const [profile, setProfile] = useState({ name: '', empId: '', position: '', dept: 'NI', sheetId: '1OuwcTThIkpC_871JIv_D5fd29-jPsoqwsyP55AFAd_I' });
            const [projects, setProjects] = useState([]); 
            const [currentMonth, setCurrentMonth] = useState(new Date().toISOString().slice(0, 7)); 
            const [editingEntry, setEditingEntry] = useState(null);
            const [syncStatus, setSyncStatus] = useState('');

            useEffect(() => {
                const savedEntries = localStorage.getItem('ts_entries_v28');
                const savedProfile = localStorage.getItem('ts_profile_v28');
                const savedProjects = localStorage.getItem('ts_projects_v28');
                
                if (savedEntries) setEntries(JSON.parse(savedEntries));
                if (savedProfile) setProfile(JSON.parse(savedProfile));
                if (savedProjects) setProjects(JSON.parse(savedProjects));
                else setView('settings'); 
            }, []);

            useEffect(() => { localStorage.setItem('ts_entries_v28', JSON.stringify(entries)); }, [entries]);
            useEffect(() => { localStorage.setItem('ts_profile_v28', JSON.stringify(profile)); }, [profile]);
            useEffect(() => { localStorage.setItem('ts_projects_v28', JSON.stringify(projects)); }, [projects]);

            const period = useMemo(() => getSalaryPeriod(currentMonth), [currentMonth]);
            const monthlyEntries = useMemo(() => {
                return entries.filter(e => e.date >= period.start && e.date <= period.end)
                              .sort((a,b) => new Date(b.date) - new Date(a.date)); 
            }, [entries, period]);

            const stats = useMemo(() => {
                let normal = 0, ot = 0;
                monthlyEntries.forEach(e => {
                    const h = calculateHours(e.startTime, e.endTime, e.breakTime);
                    if (e.otType === 'NORMAL') normal += h; else ot += h;
                });
                return { normal: normal.toFixed(1), ot: ot.toFixed(1) };
            }, [monthlyEntries]);

            const handleSyncProjects = async () => {
                if(!profile.sheetId) return alert("Vui lòng nhập Sheet ID!");
                setSyncStatus('Đang đồng bộ...');
                try {
                    const sheetUrl = `https://docs.google.com/spreadsheets/d/${profile.sheetId}/export?format=csv`;
                    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(sheetUrl)}`;
                    const response = await fetch(proxyUrl);
                    if(!response.ok) throw new Error("Không thể tải file.");
                    const csvText = await response.text();
                    const rows = csvText.split('\n').map(row => row.split(','));
                    const newProjects = [];
                    for(let i=1; i<rows.length; i++) {
                        const cols = rows[i];
                        if(cols.length > 3) {
                            const name = cols[2]?.replace(/"/g, '').trim(); 
                            const wn = cols[3]?.replace(/"/g, '').trim();   
                            if(wn && name) newProjects.push({ workNumber: wn, projectName: name });
                        }
                    }
                    setProjects(newProjects);
                    setSyncStatus(`Đã đồng bộ ${newProjects.length} dự án!`);
                    setTimeout(() => setSyncStatus(''), 3000);
                } catch (err) {
                    setSyncStatus('Lỗi đồng bộ');
                    alert("Lỗi: Đảm bảo file Sheet đã Publish to Web.");
                }
            };

            const handleDelete = (id) => {
                if (confirm('Xóa dòng này?')) setEntries(entries.filter(e => e.id !== id));
            };

            const handleResetData = () => {
                if (confirm("CẢNH BÁO: Bạn có chắc chắn muốn xóa TOÀN BỘ dữ liệu? Hành động này sẽ xóa sạch lịch sử chấm công và thông tin cá nhân. Không thể hoàn tác!")) {
                    if(confirm("Xác nhận lần 2: Xóa tất cả dữ liệu?")) {
                        localStorage.removeItem('ts_entries_v28');
                        localStorage.removeItem('ts_profile_v28');
                        localStorage.removeItem('ts_projects_v28');
                        setEntries([]);
                        setProfile({ name: '', empId: '', position: '', dept: 'NI', sheetId: '1OuwcTThIkpC_871JIv_D5fd29-jPsoqwsyP55AFAd_I' });
                        setProjects([]);
                        alert("Đã xóa dữ liệu thành công! Ứng dụng đã được reset.");
                    }
                }
            };

            const handleNewEntry = () => {
                let defaultD = new Date().toISOString().slice(0, 10); 
                
                if (entries && entries.length > 0) {
                    const sorted = [...entries].sort((a,b) => new Date(b.date) - new Date(a.date));
                    const latest = sorted[0];
                    if(latest) {
                        const nextDay = new Date(latest.date);
                        nextDay.setDate(nextDay.getDate() + 1);
                        defaultD = nextDay.toISOString().slice(0, 10);
                    }
                }
                
                setEditingEntry(null);
                setView('form_new_' + defaultD);
            };

            const handleSaveEntry = (data) => {
                if (editingEntry) setEntries(entries.map(e => e.id === editingEntry.id ? { ...data, id: editingEntry.id } : e));
                else setEntries([...entries, { ...data, id: Date.now() }]);
                setEditingEntry(null);
                setView('list');
            };

            const handleExportExcel = async () => {
                if (monthlyEntries.length === 0) return alert("Chưa có dữ liệu!");
                const sortedData = [...monthlyEntries].sort((a,b) => new Date(a.date) - new Date(b.date));
                const workbook = new ExcelJS.Workbook();
                const sheet = workbook.addWorksheet('Timesheet', { views: [{ showGridLines: false }] });

                const cols = [
                    { width: 14 }, { width: 22 }, { width: 12 }, { width: 8 },  
                    { width: 10 }, { width: 10 }, 
                    { width: 8 }, { width: 8 }, { width: 8 }, { width: 8 }, { width: 8 }, { width: 8 }, { width: 8 }, { width: 8 }, { width: 8 }, { width: 8 }, { width: 8 }, { width: 8 }, 
                    { width: 25 }, { width: 15 }, { width: 10 } 
                ];
                ACTIVITY_META.forEach(() => cols.push({ width: 5 })); 
                cols.push({ width: 25 });
                sheet.columns = cols;

                const borderAll = { top: {style:'thin'}, left: {style:'thin'}, bottom: {style:'thin'}, right: {style:'thin'} };
                const fontNormal = { name: 'Arial', size: 8 };
                const fontBold = { name: 'Arial', size: 9, bold: true };
                const alignCenter = { vertical: 'middle', horizontal: 'center', wrapText: true };
                const numFmtHideZero = '#,##0.00;-#,##0.00;;'; 

                sheet.mergeCells('C1:H1'); const c1 = sheet.getCell('C1'); c1.value = "Schindler Vietnam Ltd."; c1.font = { name: 'Arial', size: 11, bold: true, color: { argb: 'FFFF0000' } };
                sheet.mergeCells('C2:H2'); const c2 = sheet.getCell('C2'); c2.value = "NI / MOD / TFD / Safety"; c2.font = { name: 'Arial', size: 11, bold: true };
                sheet.getCell('C3').value = "EMPLOYEE NAME :"; sheet.getCell('C3').font = fontBold;
                sheet.mergeCells('E3:J3'); sheet.getCell('E3').value = profile.name; sheet.getCell('E3').font = { ...fontBold, color: { argb: 'FF000080' } };
                sheet.getCell('Q3').value = "MONTH :"; sheet.getCell('Q3').font = fontBold;
                sheet.getCell('R3').value = formatMonthVietnamese(currentMonth); sheet.getCell('R3').font = fontBold;
                sheet.getCell('C4').value = "EMPLOYEE NO :"; sheet.getCell('C4').font = fontBold;
                const e4 = sheet.getCell('E4'); e4.value = profile.empId; e4.font = { ...fontBold, color: { argb: 'FF000080' } };
                sheet.getCell('V4').value = "POSITION:"; sheet.getCell('V4').font = fontBold;
                sheet.getCell('X4').value = profile.position;
                sheet.getCell('AQ4').value = "DEPT/AREA :"; sheet.getCell('AQ4').font = fontBold;
                sheet.getCell('AT4').value = profile.dept;

                const row6 = sheet.getRow(6);
                ACTIVITY_META.forEach((item, idx) => { const cell = row6.getCell(22 + idx); cell.value = item.cat; cell.font = { name: 'Arial', size: 8, color: { argb: 'FF808080' } }; cell.alignment = alignCenter; cell.border = borderAll; });
                
                const row7 = sheet.getRow(7);
                row7.getCell(5).value = "Hour/s"; row7.getCell(19).value = "Identifier"; row7.getCell(22).value = "NI / MOD / TF / Safety";
                [5, 19, 22].forEach(idx => { const c = row7.getCell(idx); c.font = { size: 8, italic: true, name: 'Arial' }; c.alignment = { vertical: 'bottom' }; });
                for(let c=1; c<=21; c++) row7.getCell(c).border = borderAll;

                const row8 = sheet.getRow(8);
                const lastCol = 21 + ACTIVITY_META.length + 1;
                for(let c=1; c<=lastCol; c++) row8.getCell(c).border = borderAll;
                row8.height = 15;

                const row9 = sheet.getRow(9);
                const headers = ["Employee No. / Mã NV\nHRMS code\n(#5xxxxx)", "Name\n(Tên NV)", "Date / Ngày", "Week Day\n(Sunday: 1\nMon: 2\n…\nSat: 7)\n", "From", "To", "Normal Hour (Giờ làm việc bình thường)", "Breaktime \n(Nghỉ giữa giờ - Ăn trưa | ăn tối,…)", "OT1 - Normal Day\n(Giờ làm việc từ 17:00 - 22:00 - ngày thường)", "OT2 - Sunday\n(Giờ làm việc ngày CN từ 8:00 - 22:00)", "OT3 - Holiday\n(Giờ làm việc ngày lễ từ 8:00 - 22:00)", "OT4 - Normal Day (night shift 1)\n(Giờ làm việc từ 22:00 - 6:00 hôm sau ngày thường\nvà Không làm việc ngoài giờ  từ 17:00 - 22:00)", "OT5 - Sunday (night shift)\n(Giờ làm việc từ  22:00 - 6:00 hôm sau trong - ngày CN)", "OT6 - Holiday (night shift)\n(Giờ làm việc từ  22:00 - 6:00 hôm sau - ngày lễ)", "OT7 - Normal day (night shift 2)\n(Giờ làm việc từ 22:00 - 6:00 hôm sau - Ngày thường\nvà có làm việc ngoài giờ  từ 17:00 - 22:00 trước đó)", "Standby / Duty \n(Giờ trực)", "Check\n(Luôn bằng 0)", "Code", "Project Name / Description", "Work Number", "Type"];
                headers.forEach((h, i) => { const cell = row9.getCell(i+1); cell.value = h; cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFD9D9D9' } }; cell.font = fontBold; cell.border = borderAll; cell.alignment = alignCenter; });
                ACTIVITY_META.forEach((item, idx) => { const cell = row9.getCell(22+idx); cell.value = item.desc; cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFD9D9D9' } }; cell.font = { size: 8, name: 'Arial' }; cell.alignment = { textRotation: 90, vertical: 'middle', horizontal: 'center', wrapText: true }; cell.border = borderAll; });
                const rem = row9.getCell(lastCol); rem.value = "Remarks"; rem.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFD9D9D9' } }; rem.font = fontBold; rem.border = borderAll; rem.alignment = alignCenter;
                row9.height = 250;

                const row10 = sheet.getRow(10);
                for(let c=1; c<=21; c++) row10.getCell(c).border = borderAll;
                ACTIVITY_META.forEach((item, idx) => { const cell = row10.getCell(22+idx); cell.value = item.code; cell.font = { size: 8, name: 'Arial' }; cell.alignment = alignCenter; cell.border = borderAll; });
                row10.getCell(lastCol).border = borderAll;
                row10.height = 20;

                sortedData.forEach((e, index) => {
                    const r = 11 + index;
                    const row = sheet.getRow(r);
                    const otIndex = e.otType.startsWith('OT') ? parseInt(e.otType.replace('OT', '')) - 1 : -1;

                    row.getCell(1).value = { formula: '$E$4' }; 
                    row.getCell(2).value = { formula: '$E$3' }; 
                    row.getCell(3).value = new Date(e.date); row.getCell(3).numFmt = 'dd/mm/yyyy';
                    row.getCell(4).value = { formula: `WEEKDAY(C${r},1)` };
                    row.getCell(5).value = timeToExcel(e.startTime); row.getCell(5).numFmt = 'h:mm';
                    row.getCell(6).value = timeToExcel(e.endTime); row.getCell(6).numFmt = 'h:mm';
                    const hForm = `(F${r}-E${r})*24-H${r}`;
                    row.getCell(7).value = e.otType === 'NORMAL' ? { formula: `IF(${hForm}>0,${hForm},0)` } : 0;
                    row.getCell(8).value = parseFloat(e.breakTime) || 0;
                    for(let k=0; k<7; k++) { if (k === otIndex) row.getCell(9+k).value = { formula: hForm }; else row.getCell(9+k).value = 0; }
                    row.getCell(16).value = parseFloat(e.dutyHour) || 0;
                    row.getCell(17).value = { formula: `(F${r}-E${r})*24-SUM(G${r}:O${r})` };
                    row.getCell(18).value = { formula: `INDEX($V$10:$BA$10,MATCH("x",V${r}:BA${r},0))` };
                    row.getCell(19).value = e.projectName; row.getCell(19).alignment = { vertical: 'middle', horizontal: 'left', wrapText: true };
                    row.getCell(20).value = e.workNumber;
                    row.getCell(21).value = { formula: `INDEX($V$6:$BA$6,MATCH(R${r},$V$10:$BA$10,0))` };
                    const metaIdx = ACTIVITY_META.findIndex(m => m.id === e.activityCode);
                    if (metaIdx > -1) row.getCell(22 + metaIdx).value = 'x';
                    row.getCell(lastCol).value = e.remarks || ''; row.getCell(lastCol).alignment = { vertical: 'middle', horizontal: 'left', wrapText: true };

                    for(let i=1; i<=lastCol; i++) {
                        if(i!==19 && i!==lastCol) {
                            const cell = row.getCell(i);
                            cell.border = borderAll;
                            cell.font = fontNormal;
                            cell.alignment = alignCenter;
                            if (i >= 7 && i <= 17) cell.numFmt = numFmtHideZero;
                        } else {
                             row.getCell(i).border = borderAll;
                             row.getCell(i).font = fontNormal;
                        }
                    }
                });

                const totalRowIdx = 11 + sortedData.length;
                const totalRow = sheet.getRow(totalRowIdx);
                totalRow.getCell(1).value = "TOTAL";
                sheet.mergeCells(`A${totalRowIdx}:F${totalRowIdx}`);
                for(let c=7; c<=16; c++) { totalRow.getCell(c).value = { formula: `SUM(${sheet.getColumn(c).letter}11:${sheet.getColumn(c).letter}${totalRowIdx-1})` }; totalRow.getCell(c).numFmt = numFmtHideZero; }
                for(let i=1; i<=lastCol; i++) { const c = totalRow.getCell(i); c.border = borderAll; c.font = fontBold; c.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFFFFF00' } }; c.alignment = alignCenter; }

                const sigRowIdx = totalRowIdx + 3;
                sheet.mergeCells(`C${sigRowIdx}:E${sigRowIdx}`); sheet.getCell(`C${sigRowIdx}`).value = "Employee's Signature";
                sheet.mergeCells(`H${sigRowIdx}:K${sigRowIdx}`); sheet.getCell(`H${sigRowIdx}`).value = "Line Manager / Supervisor";
                sheet.mergeCells(`O${sigRowIdx}:R${sigRowIdx}`); sheet.getCell(`O${sigRowIdx}`).value = "Approved by";
                [3, 8, 15].forEach(c => { const cell = sheet.getCell(sigRowIdx, c); cell.font = { bold: true, italic: true }; cell.alignment = alignCenter; });

                const buffer = await workbook.xlsx.writeBuffer();
                const cleanName = removeAccents(profile.name || 'Timesheet');
                const [y, m] = currentMonth.split('-');
                const fileName = `${cleanName}_Thang_${m}_${y}.xlsx`;
                saveAs(new Blob([buffer]), fileName);
            };
            
            const handleBackup = () => { const blob = new Blob([JSON.stringify({ profile, entries, projects })], { type: "application/json" }); saveAs(blob, `TS_Backup_${profile.name}.json`); };
            const handleRestore = (e) => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { try { const data = JSON.parse(e.target.result); if (data.entries) setEntries(data.entries); if (data.profile) setProfile(data.profile); if (data.projects) setProjects(data.projects); alert("Thành công!"); } catch (err) { alert("Lỗi file"); } }; reader.readAsText(file); };

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen shadow-2xl overflow-hidden relative flex flex-col">
                    <header className="bg-blue-800 text-white p-4 sticky top-0 z-50 shadow-lg">
                        <div className="flex justify-between items-center mb-3">
                            <h1 className="font-bold text-lg flex items-center gap-2">Timesheet <span className="bg-green-500 text-white text-[10px] px-1.5 py-0.5 rounded">V34</span></h1>
                            <button onClick={() => setView('settings')}><Icons.Settings/></button>
                        </div>
                        <div className="bg-blue-900/50 p-2 rounded-lg flex items-center justify-between backdrop-blur-sm border border-blue-700">
                            <span className="text-xs font-bold text-white">Kỳ lương</span>
                            <input type="month" value={currentMonth} onChange={(e) => setCurrentMonth(e.target.value)} className="bg-white text-blue-900 text-sm font-bold px-2 py-1 rounded w-32 text-center"/>
                        </div>
                        <div className="mt-3 grid grid-cols-2 gap-2">
                            <div className="bg-white/10 p-2 rounded flex flex-col items-center"><span className="text-[10px] text-blue-200">Giờ công thường</span><span className="font-bold text-white text-lg">{stats.normal}h</span></div>
                            <div className="bg-white/10 p-2 rounded flex flex-col items-center"><span className="text-[10px] text-orange-200">Tăng ca (OT)</span><span className="font-bold text-orange-300 text-lg">{stats.ot}h</span></div>
                        </div>
                    </header>

                    <main className="flex-1 bg-slate-50 p-3 pb-28 overflow-y-auto">
                        {view === 'list' && (
                            <div className="space-y-3">
                                {monthlyEntries.length === 0 ? <p className="text-center text-slate-400 py-10">Chưa có dữ liệu ({period.label})</p> : monthlyEntries.map(e => (
                                    <div key={e.id} className="bg-white p-3 rounded-xl shadow-sm border relative">
                                        <div className="flex justify-between border-b pb-2 mb-2">
                                            <span className="font-bold text-blue-800">{e.date.split('-').reverse().join('/')}</span>
                                            <div className="flex gap-2"><button onClick={() => { setEditingEntry(e); setView('form'); }} className="text-blue-500"><Icons.Edit/></button><button onClick={() => handleDelete(e.id)} className="text-red-400"><Icons.Trash/></button></div>
                                        </div>
                                        <div className="text-sm flex justify-between mb-1">
                                            <span>{e.startTime} - {e.endTime}</span>
                                            <span className="font-bold text-orange-600">{e.otType !== 'NORMAL' ? e.otType : 'Giờ công thường'}</span>
                                        </div>
                                        <div className="text-xs text-slate-500 truncate"><span className="font-bold text-blue-600">[{e.activityCode}]</span> {e.projectName}</div>
                                    </div>
                                ))}
                            </div>
                        )}
                        {(view === 'form' || view.startsWith('form_new_')) && (
                            <EntryForm 
                                initialData={editingEntry} 
                                defaultDate={view.startsWith('form_new_') ? view.split('_')[2] : new Date().toISOString().slice(0, 10)}
                                onSave={handleSaveEntry} 
                                onCancel={() => { setEditingEntry(null); setView('list'); }} 
                                entries={entries} 
                                projects={projects}
                            />
                        )}
                        {view === 'settings' && (
                            <div className="bg-white p-5 rounded-xl space-y-6">
                                <h2 className="font-bold text-lg text-slate-800">Cài đặt</h2>
                                <div className="grid gap-3">
                                    <input type="text" placeholder="Họ Tên" value={profile.name} onChange={e=>setProfile({...profile, name:e.target.value})} className="w-full border p-2 rounded"/>
                                    <input type="text" placeholder="Mã NV" value={profile.empId} onChange={e=>setProfile({...profile, empId:e.target.value})} className="w-full border p-2 rounded"/>
                                    <input type="text" placeholder="Chức vụ" value={profile.position} onChange={e=>setProfile({...profile, position:e.target.value})} className="w-full border p-2 rounded"/>
                                    <input type="text" placeholder="Phòng ban" value={profile.dept} onChange={e=>setProfile({...profile, dept:e.target.value})} className="w-full border p-2 rounded"/>
                                </div>
                                <hr/>
                                <div>
                                    <h2 className="font-bold text-sm text-slate-800 mb-2 flex items-center gap-2"><Icons.Database/> Cơ sở dữ liệu Dự án</h2>
                                    <div className="flex flex-col gap-2">
                                        <input type="text" value={profile.sheetId || ''} onChange={e => setProfile({...profile, sheetId: e.target.value})} className="w-full border p-2 rounded text-sm" placeholder="Google Sheet ID..."/>
                                        <button onClick={handleSyncProjects} disabled={!profile.sheetId} className="bg-blue-600 text-white p-2 rounded text-sm disabled:opacity-50"><Icons.Refresh/> {syncStatus || 'Đồng bộ ngay'}</button>
                                        <span className="text-xs text-green-600">{projects.length} dự án đã lưu</span>
                                    </div>
                                </div>
                                <hr/>
                                <div className="bg-slate-50 p-3 rounded border grid grid-cols-2 gap-2">
                                    <button onClick={handleBackup} className="bg-white border p-2 rounded text-blue-700 text-xs font-bold"><Icons.Download/> Backup</button>
                                    <label className="bg-white border p-2 rounded text-green-700 text-xs font-bold cursor-pointer flex justify-center items-center"><Icons.Upload/> Restore <input type="file" onChange={handleRestore} className="hidden"/></label>
                                </div>
                                
                                <hr/>
                                <div className="p-4 border border-red-200 rounded-lg bg-red-50">
                                    <h3 className="text-red-700 font-bold text-sm mb-2 flex items-center gap-2"><Icons.Alert/> Vùng Nguy Hiểm</h3>
                                    <button onClick={handleResetData} className="w-full py-2 bg-red-600 hover:bg-red-700 text-white rounded text-sm font-bold shadow-sm transition-colors">
                                        Xóa Toàn Bộ Dữ Liệu
                                    </button>
                                    <p className="text-red-500 text-[10px] mt-2 text-center">Hành động này sẽ xóa hết lịch sử và cài đặt. Không thể khôi phục.</p>
                                </div>
                                
                                <button onClick={() => setView('list')} className="w-full bg-slate-800 text-white p-3 rounded font-bold">Lưu thông tin</button>
                            </div>
                        )}
                    </main>

                    {view === 'list' && (
                        <div className="fixed bottom-6 right-6 flex flex-col gap-3 z-40">
                            <button onClick={handleExportExcel} className="bg-green-600 text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center border-2 border-white"><Icons.Download/></button>
                            <button onClick={handleNewEntry} className="bg-blue-600 text-white w-16 h-16 rounded-full shadow-xl flex items-center justify-center border-4 border-blue-100"><Icons.Plus/></button>
                        </div>
                    )}
                </div>
            );
        }

        function EntryForm({ onSave, onCancel, defaultDate, initialData, entries, projects }) {
            const [formData, setFormData] = useState({ 
                date: defaultDate, startTime: '08:00', endTime: '17:00', breakTime: '1', 
                otType: 'NORMAL', projectName: '', workNumber: '', activityCode: '1110', dutyHour: '0', remarks: ''
            });
            const [customCode, setCustomCode] = useState('');
            const [suggestions, setSuggestions] = useState([]);

            const isHR = useMemo(() => {
                const act = ACTIVITY_META.find(a => a.id === formData.activityCode);
                return act && act.cat === 'HR';
            }, [formData.activityCode]);

            // === AUTO-SELECT OT LOGIC ===
            const determineOTType = useCallback((dateStr, startTime) => {
                if (!dateStr || !startTime) return 'NORMAL';
                
                const date = new Date(dateStr);
                const day = date.getDay(); // 0 = Sun, 6 = Sat
                const isHol = isVietnameseHoliday(dateStr);
                const startHour = parseInt(startTime.split(':')[0]);
                
                // NIGHT SHIFT (Starts >= 22:00)
                if (startHour >= 22) {
                    if (isHol) return 'OT6'; // Holiday Night
                    if (day === 0 || day === 6) return 'OT5'; // Sat/Sun Night
                    return 'OT4'; // Normal Night (Default)
                }

                // DAY SHIFT
                if (isHol) return 'OT3'; // Holiday Day
                
                if (day === 0) return 'OT2'; // Sunday Day
                
                if (day === 6) {
                    // Saturday: Afternoon (>= 13:00) is OT2
                    if (startHour >= 13) return 'OT2';
                    return 'NORMAL'; // Saturday Morning is usually Normal
                }
                
                // Mon-Fri
                if (startHour >= 17) return 'OT1'; // Normal Day Evening
                
                return 'NORMAL';
            }, []);

            // Auto-run logic when Date or StartTime changes
            useEffect(() => {
                const suggested = determineOTType(formData.date, formData.startTime);
                
                // SPECIAL CASE: Don't auto-switch if user selected OT7 and suggestion is OT4
                if (formData.otType === 'OT7' && suggested === 'OT4') return;
                
                if (formData.otType !== suggested) {
                    // NEW LOGIC: Normal -> BreakTime = 1, OT -> BreakTime = 0
                    const newBreakTime = (suggested !== 'NORMAL') ? '0' : '1';
                    setFormData(prev => ({ ...prev, otType: suggested, breakTime: newBreakTime }));
                }
            }, [formData.date, formData.startTime, determineOTType]);

            useEffect(() => { 
                if (initialData) {
                    setFormData(initialData);
                    const isStandard = ACTIVITY_META.some(opt => opt.id === initialData.activityCode);
                    if (!isStandard) { setCustomCode(initialData.activityCode); setFormData(prev => ({...prev, activityCode: 'OTHER'})); }
                } else {
                    fillFromDate(defaultDate);
                }
            }, [initialData]); 

            const fillFromDate = (targetDate) => {
                 if (!entries || entries.length === 0) {
                    setFormData(prev => ({ ...prev, projectName: '', workNumber: '', activityCode: '1110' }));
                    return;
                 }
                 const current = new Date(targetDate);
                 current.setDate(current.getDate() - 1);
                 const prevDateStr = current.toISOString().slice(0, 10);
                 let sourceEntry = entries.find(e => e.date === prevDateStr);
                 if (!sourceEntry) {
                    const sorted = [...entries].sort((a,b) => new Date(b.date) - new Date(a.date));
                    sourceEntry = sorted[0];
                 }
                 if (sourceEntry) {
                    setFormData(prev => ({
                        ...prev,
                        projectName: sourceEntry.projectName,
                        workNumber: sourceEntry.workNumber,
                        activityCode: sourceEntry.activityCode || '1110'
                    }));
                    const isStandard = ACTIVITY_META.some(opt => opt.id === sourceEntry.activityCode);
                    if (!isStandard && sourceEntry.activityCode !== 'OTHER') {
                        setCustomCode(sourceEntry.activityCode);
                        setFormData(prev => ({...prev, activityCode: 'OTHER'}));
                    }
                 } else {
                    setFormData(prev => ({ ...prev, projectName: '', workNumber: '', activityCode: '1110' }));
                 }
            };

            const handleDateChange = (e) => {
                const newDate = e.target.value;
                setFormData(prev => ({ ...prev, date: newDate }));
                if (!initialData) fillFromDate(newDate);
            };

            const handleActivityCodeChange = (e) => {
                const code = e.target.value;
                let newData = { ...formData, activityCode: code };
                if (code === '6090') {
                    newData.startTime = '';
                    newData.endTime = '';
                    newData.breakTime = '0';
                }
                setFormData(newData);
            };

            const handleOtChange = (e) => {
                const type = e.target.value;
                let newData = { ...formData, otType: type };
                
                // NEW LOGIC: Manual OT Selection
                if (type !== 'NORMAL') {
                    newData.breakTime = '0';
                } else {
                    newData.breakTime = '1';
                }
                setFormData(newData);
            };

            const handleProjectNameSearch = (val) => {
                setFormData(prev => ({ ...prev, projectName: val }));
                if (val.length > 0 && projects) {
                    const searchTerms = normalizeString(val).split(" ").filter(Boolean);
                    const matches = projects.filter(p => {
                         const pName = normalizeString(p.projectName);
                         const pNum = normalizeString(p.workNumber);
                         return searchTerms.every(t => pName.includes(t) || pNum.includes(t));
                    });
                    setSuggestions(matches);
                } else {
                    setSuggestions([]);
                }
            };

            const selectProject = (proj) => {
                setFormData(prev => ({ ...prev, workNumber: proj.workNumber, projectName: proj.projectName }));
                setSuggestions([]);
            };

            const handleSubmit = () => {
                const finalData = { ...formData };
                if (finalData.activityCode === 'OTHER') {
                    if(!customCode) return alert("Vui lòng nhập mã code!");
                    finalData.activityCode = customCode;
                }
                onSave(finalData);
            };

            return (
                <div className="bg-white p-4 rounded-xl shadow-lg animate-fade-in-up">
                    <h2 className="font-bold text-lg mb-4 text-blue-800 border-b pb-2">{initialData ? 'Sửa' : 'Thêm'}</h2>
                    <div className="space-y-4">
                        <div><label className="text-xs font-bold text-slate-500">NGÀY</label><input type="date" value={formData.date} onChange={handleDateChange} className="w-full border p-3 rounded-lg"/></div>
                        <div className="grid grid-cols-3 gap-2">
                            <div><label className="text-xs font-bold text-slate-500">TỪ</label><input type="time" value={formData.startTime} onChange={e=>setFormData({...formData, startTime:e.target.value})} className="w-full border p-2 rounded-lg text-center"/></div>
                            <div><label className="text-xs font-bold text-slate-500">ĐẾN</label><input type="time" value={formData.endTime} onChange={e=>setFormData({...formData, endTime:e.target.value})} className="w-full border p-2 rounded-lg text-center"/></div>
                            <div><label className="text-xs font-bold text-slate-500">NGHỈ</label><input type="number" step="0.5" value={formData.breakTime} onChange={e=>setFormData({...formData, breakTime:e.target.value})} className="w-full border p-2 rounded-lg text-center"/></div>
                        </div>
                        <div><label className="text-xs font-bold text-slate-500">TRỰC (STANDBY)</label><input type="number" step="0.5" value={formData.dutyHour} onChange={e=>setFormData({...formData, dutyHour:e.target.value})} className="w-full border p-3 rounded-lg"/></div>
                        
                        <div>
                            <label className="text-xs font-bold text-slate-500">LOẠI GIỜ (Tự động đề xuất)</label>
                            <select value={formData.otType} onChange={handleOtChange} className="w-full border p-3 rounded-lg bg-white">
                                {OT_TYPES.map(t => <option key={t.code} value={t.code}>{t.label}</option>)}
                            </select>
                            {isVietnameseHoliday(formData.date) && <p className="text-xs text-red-500 mt-1">* Phát hiện ngày lễ VN: {formData.date}</p>}
                        </div>
                        
                        <div className="pt-2 border-t space-y-3">
                            <div>
                                <label className="text-xs font-bold text-slate-500">MÃ CÔNG VIỆC</label>
                                <select value={formData.activityCode} onChange={handleActivityCodeChange} className="w-full border p-3 rounded-lg font-bold text-blue-900">
                                    {ACTIVITY_META.map(opt => <option key={opt.id} value={opt.id}>{opt.desc}</option>)}
                                    <option value="OTHER">Khác</option>
                                </select>
                                {formData.activityCode === 'OTHER' && <input type="text" value={customCode} onChange={e=>setCustomCode(e.target.value)} placeholder="Nhập mã code" className="mt-2 w-full border p-2 rounded text-sm bg-yellow-50"/>}
                            </div>
                            
                            <div className="relative">
                                <label className="text-xs font-bold text-slate-500">TÊN DỰ ÁN</label>
                                <input type="text" value={formData.projectName} onChange={e=>handleProjectNameSearch(e.target.value)} className="w-full border p-3 rounded-lg" placeholder="Nhập tên dự án..."/>
                                {suggestions.length > 0 && <div className="suggestion-list">{suggestions.map((p, idx) => <div key={idx} onClick={() => selectProject(p)} className="suggestion-item"><span className="font-bold">{p.projectName}</span><br/><span className="text-gray-500 text-xs">{p.workNumber}</span></div>)}</div>}
                            </div>

                            <div>
                                <label className="text-xs font-bold text-slate-500">WORK NUMBER / WBS / MÃ CHI PHÍ</label>
                                {isHR ? (
                                    <select value={formData.workNumber} onChange={e=>setFormData({...formData, workNumber:e.target.value})} className="w-full border p-3 rounded-lg bg-white">
                                        <option value="">-- Chọn loại nghỉ --</option>
                                        {HR_WORK_NUMBERS.map(wn => <option key={wn} value={wn}>{wn}</option>)}
                                    </select>
                                ) : (
                                    <input type="text" value={formData.workNumber} onChange={e=>setFormData({...formData, workNumber:e.target.value})} className="w-full border p-3 rounded-lg"/>
                                )}
                            </div>
                            
                            <div><label className="text-xs font-bold text-slate-500">GHI CHÚ (REMARKS)</label><input type="text" value={formData.remarks || ''} onChange={e=>setFormData({...formData, remarks:e.target.value})} className="w-full border p-3 rounded-lg" placeholder="Ghi chú thêm..."/></div>
                        </div>
                        <div className="flex gap-3 pt-4"><button onClick={onCancel} className="flex-1 p-3 border rounded-lg font-bold text-slate-500">Hủy</button><button onClick={handleSubmit} className="flex-1 p-3 bg-blue-600 text-white rounded-lg font-bold shadow">Lưu</button></div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
